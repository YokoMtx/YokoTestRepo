# オセロゲーム設計書

## 1. 概要

このドキュメントは、シンプルなオセロゲームの設計について記述します。このゲームはウェブブラウザ上で動作し、ユーザーがオセロをプレイできるインタラクティブなインターフェースを提供します。

## 2. 機能

*   **初期ボード表示**: ゲーム開始時に標準的なオセロの初期配置（中央に白2つ、黒2つ）を表示します。
*   **駒の配置**: プレイヤーは有効なマスをクリックして駒を配置できます。
*   **駒の反転**: 有効な手を打つと、挟まれた相手の駒が自分の色に反転します。
*   **スコア表示**: 現在の黒と白の駒の数をリアルタイムで表示します。
*   **現在のプレイヤー表示**: 現在の手番のプレイヤー（黒または白）を表示します。
*   **パス機能**: 有効な手がない場合、プレイヤーは自動的にパスし、手番が相手に移ります。
*   **ゲーム終了判定**: 両プレイヤーが有効な手を打てなくなった場合にゲームが終了し、勝敗（または引き分け）をアラートで表示します。
*   **リセット機能**: リセットボタンをクリックすると、ゲームが初期状態に戻ります。
*   **無効な手のアラート**: 無効なマスをクリックした場合、アラートメッセージが表示されます。

## 3. 技術スタック

*   **HTML5**: ゲームの構造とコンテンツを定義します。
*   **CSS3**: ゲームの視覚的なスタイルとレイアウトを定義します。
*   **JavaScript (ES6+)**: ゲームのロジック、インタラクション、および動的なコンテンツ更新を実装します。
*   **Playwright**: ブラウザ自動化フレームワークとして、ゲームのE2E（End-to-End）テストに使用されます。

## 4. ファイル構成

```
AI_Test/
├── index.html      # ゲームのメインHTMLファイル
├── style.css       # ゲームのスタイルシート
├── script.js       # ゲームの主要なJavaScriptロジック
└── tests/
    └── othello.spec.js # Playwrightによるテストコード
```

## 5. UI/UX デザイン

*   **レイアウト**:
    *   `body` はフレックスボックスで中央揃えに配置されます。
    *   `#game-container` はボードとゲーム情報パネルを横並びに配置します。
*   **ボード**:
    *   `#board` は8x8のCSSグリッドで構成され、各セルは `50px x 50px` の正方形です。
    *   背景色は濃い緑色 (`#006400`) でオセロ盤を表現します。
*   **セルと駒**:
    *   `.cell` は1pxの境界線を持つ正方形です。
    *   `.piece` は `40px x 40px` の円形で、黒または白の背景色を持ちます。
*   **ゲーム情報**:
    *   `#game-info` パネルは白い背景で、現在のプレイヤー、黒と白のスコア、リセットボタンを表示します。
    *   シャドウ効果で視覚的に強調されます。
*   **リセットボタン**:
    *   青色の背景 (`#007bff`) を持つボタンで、ホバー時に色が変化します。

## 6. ゲームロジック (script.js)

### グローバル変数と定数

*   `boardElement`, `currentPlayerElement`, `blackScoreElement`, `whiteScoreElement`, `resetButton`: HTML要素への参照。
*   `EMPTY`, `BLACK`, `WHITE`: 駒の状態を表す定数 (0, 1, 2)。
*   `board`: 8x8の二次元配列でゲームボードの状態を保持。
*   `currentPlayer`: 現在の手番のプレイヤー (BLACK または WHITE)。
*   `blackScore`, `whiteScore`: 各プレイヤーの現在のスコア。
*   `directions`: 駒を反転させるための8方向の差分配列。

### 主要関数

*   `initializeBoard()`:
    *   ボードを `EMPTY` で初期化し、中央に初期駒を配置します。
    *   `currentPlayer` を `BLACK` に設定し、スコアと表示を更新します。
*   `renderBoard()`:
    *   `board` 配列の状態に基づいてHTMLのボード要素を再描画します。
    *   各セルにクリックイベントリスナーを追加します。
*   `updateScores()`:
    *   `board` 配列を走査し、黒と白の駒の数を数えてスコア表示を更新します。
*   `updatePlayerDisplay()`:
    *   `currentPlayer` に応じて「現在のプレイヤー」表示を更新します。
*   `isValidMove(row, col, player)`:
    *   指定された `(row, col)` が `EMPTY` であること、およびそのマスに駒を置くことで相手の駒を1つ以上反転できることを確認します。
*   `getFlippablePieces(row, col, player)`:
    *   指定された `(row, col)` に `player` が駒を置いた場合に反転するすべての駒の座標を配列で返します。
*   `makeMove(row, col, player)`:
    *   `isValidMove` が `true` の場合に、指定されたマスに `player` の駒を置き、`getFlippablePieces` で取得した駒を反転させます。
*   `switchPlayer()`:
    *   `currentPlayer` を `BLACK` と `WHITE` の間で切り替えます。
*   `hasValidMoves(player)`:
    *   指定された `player` がボード上のどこかに有効な手を持っているかをチェックします。
*   `checkGameOver()`:
    *   `BLACK` と `WHITE` の両方が `hasValidMoves` を持たない場合にゲーム終了と判断します。
    *   スコアに基づいて勝者を決定し、アラートを表示します。
*   `handleCellClick(event)`:
    *   セルのクリックイベントを処理します。
    *   有効な手であれば `makeMove` を呼び出し、ボード、スコア、プレイヤー表示を更新します。
    *   ゲーム終了、パスの処理、無効な手のアラート表示を行います。

### イベントリスナー

*   `boardElement` の各セルに `click` イベントリスナー (`handleCellClick`)。
*   `resetButton` に `click` イベントリスナー (`initializeBoard`)。

## 7. テスト (othello.spec.js)

Playwrightフレームワークを使用して、以下のE2Eテストが実装されています。

*   **初期状態のボード**: ボードのセル数、初期駒の配置、初期スコア、現在のプレイヤーが正しいことを検証します。
*   **有効な手**: 有効なマスに駒を置いた際に、駒が正しく反転し、スコアが更新され、プレイヤーが切り替わることを検証します。
*   **無効な手**: 無効なマスに駒を置こうとした際に、アラートが表示され、ゲームの状態が変化しないことを検証します。
*   **パスの処理**: プレイヤーが有効な手を持たない場合に、パスが正しく処理され、プレイヤーが切り替わることを検証します。
*   **リセット機能**: リセットボタンがゲームを初期状態に正しく戻すことを検証します。
